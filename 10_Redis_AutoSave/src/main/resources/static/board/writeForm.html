<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Board Write Form</title>
</head>
<body>
  <h1>Board Write Form (30초마다 임시저장)</h1>
  <form>
    <label>제목</label><br>
    <input type="text" id="title"><br>
    <label for ="content">내용</label><br>
    <textarea rows="5" cols="30" id="content"></textarea><br><br>
    <button type="submit" onclick="saveBoard()">작성완료</button>
  </form>
  
  <script>
   
   const baseUrl = "/api/boards";


   
   //---- 자동 저장
   function autosave(){
	   // title + content => json 문자열로 만들기
	   // fetch() 함수로 자동 저장 요청하기
	   // 응답 결과 ("Draft Saved!") 받아서 화면에 적절히 출력하기
	 const title = document.getElementById("title").value;
   const content = document.getElementById("content").value;
   const data = { title, content };
	 fetch(`${baseUrl}/autosave`, 
			   {method: "POST",
			    headers: {"Content-Type": "application/json"},
			    body: JSON.stringify(data)
			  })
	   .then(res => res.text())
	   .then(msg => {
       console.log(msg);
    })
   }
   
   //---- 현재 페이지 로드 시 자동 저장된 정보 불러오는 함수
   // fetch() 함수로 저장된 정보 요청하기
   // 응답 결과(BoardDTO) 받아서 title, content 입력 상자에 표시하기
   
   function loadDraft(){
	   const title = document.getElementById("title");
	   const content = document.getElementById("content");
	   fetch(`${baseUrl}/autosave`)
	   .then(response => response.json())
	   .then(data => { 
		    title.value = data.title;
		    content.value = data.content;
	    });
	  };
	   
	   

   
   
   //---- 게시글 저장하기
   function saveBoard(){
	   // 저장 요청하기 (BoardDTO 보낼 필요 없음)
	   // 응답 결과("Save Draft!") 받아서 화면에 적절히 출력하기
	   const title = document.getElementById("title").value;
     const content = document.getElementById("content").value;
	     fetch(baseUrl, {
       method:"POST"
      })
	   .then(res => res.text())
	   .then(data => { 
	        title.value = "";
	        content.value = "";
	        console.log(data);
	   })
   }
   
   
   //---- 자동 저장은 30초마다 호출
   setInterval(autosave, 5 * 1000);
   
   //---- 현재 페이지 로드 시 자동 저장된 정보 불러오기
   loadDraft();
  </script>
</body>
</html>